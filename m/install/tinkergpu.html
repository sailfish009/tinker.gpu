
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Build Tinker GPU &#8212; Tinker GPU User&#39;s Manual  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Special Features &amp; Methods" href="../feat/index.html" />
    <link rel="prev" title="Build the Canonical Tinker" href="tinker.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="build-tinker-gpu">
<h1>Build Tinker GPU<a class="headerlink" href="#build-tinker-gpu" title="Permalink to this headline">¶</a></h1>
<p>This section was generated by the Makefile. Every option usually has a
default value and is documented as <strong>option=default_value</strong>.
In order to override the defaults, set them in the command line as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make <span class="nv">option1</span><span class="o">=</span>value1 <span class="nv">option2</span><span class="o">=</span>value2 targets
</pre></div>
</div>
<div class="section" id="maintaining-multiple-build-directories">
<h2>Maintaining Multiple Build Directories<a class="headerlink" href="#maintaining-multiple-build-directories" title="Permalink to this headline">¶</a></h2>
<p>Please refer to <strong>create_build</strong> for creating build directories.</p>
<p>We strongly discourage compiling Tinker GPU object files within the source
code directory. A few options are necessary for
the <cite>make</cite> command, therefore, we recommend you write and keep a shell
script in every build directory to replace the general <cite>make</cite> command.</p>
<p>Some examples are given below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># file name: build-v1/z.sh</span>
<span class="c1"># GPU/single/release/fftw_dir=$HOME/local/fftw</span>
make <span class="nv">ignore</span><span class="o">=</span><span class="m">0</span> <span class="nv">host</span><span class="o">=</span>off <span class="nv">prec</span><span class="o">=</span>s <span class="nv">opt</span><span class="o">=</span>release <span class="se">\</span>
<span class="nv">fftw_dir</span><span class="o">=</span><span class="nv">$HOME</span>/local/fftw <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/tcsh</span>
<span class="c1"># file name: build-v2/z.sh</span>
<span class="c1"># CPU/doube/debug/fftw_dir=$HOME/local/fftw</span>
make <span class="nv">ignore</span><span class="o">=</span><span class="m">0</span> <span class="nv">host</span><span class="o">=</span>on <span class="nv">prec</span><span class="o">=</span>d <span class="nv">opt</span><span class="o">=</span>debug <span class="se">\</span>
<span class="nv">fftw_dir</span><span class="o">=</span><span class="nv">$HOME</span>/local/fftw <span class="s2">&quot;</span><span class="nv">$argv</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p><strong>opt=release</strong>
Optimization level. Other valid values are <cite>debug</cite> and <cite>profile</cite>.</p>
<p><strong>prec=real8</strong>
Precision of the floating point numbers.</p>
<ul class="simple">
<li><p>These equivalent values all compile the code to double precision:
<cite>real8</cite>, <cite>8</cite>, <cite>64</cite>, <cite>double</cite>, <cite>d</cite>.</p></li>
<li><p>These equivalent values all compile the code to single precision:
<cite>real4</cite>, <cite>4</cite>, <cite>32</cite>, <cite>float</cite>, <cite>single</cite>, <cite>s</cite>.</p></li>
<li><p>These equivalent values all compile the code to mixed precision:
<cite>mixed</cite>, <cite>m</cite>.</p></li>
</ul>
<p><strong>host=1</strong>
Flag to compile to GPU version or CPU version.</p>
<ul class="simple">
<li><p>These equivalent values all compile the code to GPU version:
<cite>false</cite>, <cite>off</cite>, <cite>0</cite>.</p></li>
<li><p>These equivalent values all compile the code to CPU version:
<cite>true</cite>, <cite>on</cite>, <cite>1</cite>.</p></li>
</ul>
<p><strong>deterministic_force (NO DEFAULT)</strong>
Flag to use deterministic force. There is no default value for this flag.
This feature will be implicitly enabled by mixed and single precisions, but
can be explicitly disabled by setting the flag to <cite>false</cite>, <cite>off</cite>, or <cite>0</cite>,
and can be explicitly enabled by <cite>true</cite>, <cite>on</cite>, or <cite>1</cite>.</p>
<p>In general, evaluating energy, forces etc. twice, we don’t expect to get
two identical answers, but we may not care as much because the difference
is usually negligible. (See
<a class="reference external" href="https://isocpp.org/wiki/faq/newbie#floating-point-arith2">Why is cos(x) != cos(y)?</a>)
Whereas in MD, two simulations with the same initial configurations can
easily diverge due to the accumulated difference. If, for whatever reason,
you are willing to elongate the process of the inevitable divergence at the
cost of slightly slower simulation speed, a more “deterministic” force
(using fixed-point arithmetic) can help.</p>
<p><strong>build=build</strong>
By default, Makefile can create a <cite>build</cite> directory in the current
working directory. This option allows you to use another name for
the build directory. For more information, see <strong>create_build</strong>.</p>
<p><strong>ignore=1</strong>
The default value will minimize the warning messages from the <cite>make</cite>
command, especially when we run <cite>make clean</cite>, <cite>make doc</cite> etc., where
these warnings and errors are not critical. <strong>ignore</strong> can also be set to 0,
and is recommended to build the excutables.</p>
<p><strong>tinker_dir (NO DEFAULT)</strong>
The directory in which user compiled the <cite>libtinker</cite>.
If this value is not set by a command line argument, Makefile will
attempt to locate <cite>libtinker</cite> under <cite>$HOME/tinker/source</cite> and emit a
fatal error when it fails to find it. No check will be performed if this
option is set explicitly via command line.</p>
<p><strong>fftw_dir / fftw_include / fftw_lib (NO DEFAULT)</strong>
No default values are set for these three options.</p>
<p><strong>fftw_dir</strong> is the top-level FFTW installation, under which
<cite>include/fftw3.h</cite> and <cite>lib/libfftw3</cite> are expected to be found.
If this value is not set by a command line argument, the Makefile will
attempt to locate them under <cite>/usr/local</cite>. No fatal error will
be emitted should the Makefile fail to find them.</p>
<p><strong>fftw_include</strong> and <strong>fftw_lib</strong> will override the values set by
<strong>fftw_dir</strong>. No check will be performed on <strong>fftw_*</strong> if it set by the
command line argument.</p>
<p><strong>compute_capability=60,70</strong>
CUDA compute capability. Valid values are 35, 60, 70, 75 etc., and can be
comma-separated, e.g. 35,60.</p>
<p><strong>cuda_dir=/usr/local/cuda</strong>
Top-level CUDA installation directory, under which <cite>include</cite> and <cite>lib</cite>
directories are expected to be found.</p>
<p>Sometimes the PGI compiler and the NVCC compiler are not “compatible”. For
instance, PGI 19.4 supports CUDA 9.2, 10.0, 10.1, and the default CUDA
version used in PGI 19.4 may be 9.2 and the external NVCC version is 10.1.
One solution is to pass <cite>CUDA_HOME=${cuda_dir}</cite> to the PGI compiler, in
which case, <strong>cuda_dir</strong> should be set to <cite>/usr/local/cuda-10.1</cite>.</p>
<p><strong>fortran_compiler=gfortran</strong>
Path to the Fortran compiler that compiled <cite>libtinker.a</cite>.</p>
<p><strong>fortran_config/cxx_config/acc_config/link_config (UNSPECIFIED)</strong>
Addtional files that contain Fortran, C++, OpenAcc and linker related flags.
This is the mechanism we adopt to extend the multi-compiler support.
The default file of each category on different operating systems are
different and there is <strong>NO GUARANTEE</strong> that the defaults will not change.
Tested compilers are tabulated below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 24%" />
<col style="width: 25%" />
<col style="width: 21%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>OS</p></th>
<th class="head"><p>Fortran</p></th>
<th class="head"><p>C++</p></th>
<th class="head"><p>OpenACC</p></th>
<th class="head"><p>Linker</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Linux</p></td>
<td><p>gfortran</p></td>
<td><p>g++</p></td>
<td><p>pgc++ -ta=telsa</p></td>
<td><p>pgc++ -ta=telsa</p></td>
</tr>
<tr class="row-odd"><td><p>Linux</p></td>
<td><p>gfortran</p></td>
<td><p>g++</p></td>
<td><p>g++</p></td>
<td><p>g++</p></td>
</tr>
<tr class="row-even"><td><p>Linux</p></td>
<td><p>ifort</p></td>
<td><p>icpc</p></td>
<td><p>pgc++ -ta=telsa</p></td>
<td><p>pgc++ -ta=telsa</p></td>
</tr>
<tr class="row-odd"><td><p>Linux</p></td>
<td><p>ifort</p></td>
<td><p>icpc</p></td>
<td><p>icpc</p></td>
<td><p>icpc</p></td>
</tr>
<tr class="row-even"><td><p>macOS</p></td>
<td><p>gfortran homebrew</p></td>
<td><p>clang++ xcode 10.1</p></td>
<td><p>clang++</p></td>
<td><p>clang++</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="targets">
<h2>Targets<a class="headerlink" href="#targets" title="Permalink to this headline">¶</a></h2>
<p><strong>default</strong>
Compile and link the <cite>tinker.gpu</cite> executable.</p>
<p><strong>unittest</strong>
Compile and link the <cite>all.tests</cite> executable.</p>
<p><strong>all</strong>
Make two targets: <cite>default</cite> and <cite>unittest</cite>.</p>
<p><strong>test</strong>
Run the unit tests in a random order. Exit on the first error.</p>
<p><strong>dirs</strong>
Create sub-directories inside the build directory.</p>
<p><strong>copy_files</strong>
Copy files to the build directory.</p>
<p><strong>create_build</strong>
Setup the build directory, including copying the necessary files.
For example, setup a new build directory <cite>build-v3</cite>
inside the <cite>tinker.gpu</cite> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt; <span class="nb">pwd</span>
/home/developer/tinker.gpu
$&gt; make -f make/Makefile create_build <span class="nv">build</span><span class="o">=</span>build-v3
</pre></div>
</div>
<p><strong>info</strong>
Show some of the compiler and linker flags.</p>
<p><strong>doc</strong>
Generate developers’ manual with <cite>doxygen</cite>.</p>
<p><strong>man</strong>
Generate user manual with <cite>sphinx</cite>.</p>
<p><strong>help</strong>
Print the Makefile documentation in the terminal window.</p>
<p><strong>clean</strong>
Clean up the current build directory.</p>
<p><strong>headers</strong>
Test whether the <cite>#include</cite> directives in every header file are complete.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Tinker GPU User's Manual</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction to the Software</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Installation on Your Computer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="preq.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="tinker.html">Build the Canonical Tinker</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Build Tinker GPU</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../feat/index.html">Special Features &amp; Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key/index.html">Use of the Keyword Control File</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Installation on Your Computer</a><ul>
      <li>Previous: <a href="tinker.html" title="previous chapter">Build the Canonical Tinker</a></li>
      <li>Next: <a href="../feat/index.html" title="next chapter">Special Features &amp; Methods</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Zhi Wang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/m/install/tinkergpu.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>